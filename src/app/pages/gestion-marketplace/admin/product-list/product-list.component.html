<div id="productList">
  <div class="row">
      <div class="col-lg-12">
          <div class="card">
              <div class="card-body">
                  <div class="row g-3">
                      <div class="col-xxl">
                          <div class="search-box">
                              <input type="text" class="form-control search" [(ngModel)]="term" (keyup)="filterdata()" placeholder="Search products, price etc...">
                              <i class="ri-search-line search-icon"></i>
                          </div>
                      </div><!--end col-->

                      <div class="col-xxl-3 col-sm-6">
                          <div>
                              <select class="form-control" id="idCategory" [(ngModel)]="selectedCategory" (change)="filterByCategory()">
                                  <option value="">All Categories</option>
                                  <option *ngFor="let category of categories" [value]="category.idCategorie">
                                      {{category.nomCategorie}}
                                  </option>
                              </select>
                          </div>
                      </div><!--end col-->

                      <div class="col-xxl-auto col-sm-6">
                          <button type="button" class="btn btn-secondary w-md"><i class="bi bi-funnel align-baseline me-1"></i> Filters</button>
                      </div><!--end col-->
                  </div><!--end row-->
              </div>
          </div>
      </div><!--end col-->
  </div><!--end row-->

  <div class="row">
      <div class="col-lg-12">
          <div class="card">
              <div class="card-header d-flex align-items-center">
                  <div class="flex-grow-1">
                      <h5 class="card-title mb-0">Products <span class="badge bg-dark-subtle text-dark ms-1">{{allproducts?.length || 0}}</span></h5>
                  </div>
                  <div class="flex-shrink-0">
                      <div class="d-flex flex-wrap align-items-start gap-2">
                          <button class="btn btn-subtle-danger d-none" id="remove-actions" (click)="deleteRecordModal.show()">
                              <i class="ri-delete-bin-2-line"></i>
                          </button>
                          <button type="button" class="btn btn-primary add-btn" (click)="navigateToAddProduct()">
                              <i class="bi bi-plus-circle align-baseline me-1"></i> Add Product
                          </button>
                      </div>
                  </div>
              </div>
              <div class="card-body">
                  <div class="table-responsive">
                      <table class="table align-middle table-nowrap" id="customerTable">
                          <thead class="table-light">
                              <tr>
                                  <th class="sort" (click)="onSort('nomProduit')">Product Name</th>
                                  <th class="sort" (click)="onSort('categorie')">Category</th>
                                  <th class="sort" (click)="onSort('prixProduit')">Price</th>
                                  <th class="sort" (click)="onSort('stockProduit')">Stock</th>
                                  <th>Actions</th>
                              </tr>
                          </thead>
                          <tbody>
                              <tr *ngFor="let product of products; let i = index">
                                  <td class="products">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-xs bg-light rounded p-1 me-2">
                                            <img src="{{product.imageProduit}}" alt="" class="img-fluid d-block">
                                        </div>
                                        <div>
                                            <h6 class="mb-0"><a routerLink="/ecommerce/product-details" class="text-reset products">{{product.nomProduit}}</a></h6>
                                        </div>
                                    </div>
                                </td>
                                  <td>{{product.categorie?.nomCategorie || 'Uncategorized'}}</td>
                                  <td>{{product.prixProduit | currency}}</td>
                                  <td>{{product.stockProduit}}</td>
                                  <td>
                                      <div class="d-flex gap-2">
                                          <button class="btn btn-sm btn-danger" (click)="removeItem(product.idProduit)">
                                              <i class="bi bi-trash"></i>
                                          </button>

                                          <button class="btn btn-sm edit-item-btn" (click)="editList(i)">
                                            <i class="ph-pencil align-middle me-1"></i>
                                          </button>
                                      </div>
                                  </td>
                              </tr>
                          </tbody>
                      </table>
                  </div><!--end table-responsive-->

                  <div class="noresult" style="display: none;">
                      <div class="text-center py-4">
                          <div class="avatar-md mx-auto mb-4">
                              <div class="avatar-title bg-light text-primary rounded-circle fs-4xl">
                                  <i class="bi bi-search"></i>
                              </div>
                          </div>
                          <h5 class="mt-2">Sorry! No Result Found</h5>
                          <p class="text-muted mb-0">We've searched more than 150+ products We did not find any
                              products for you search.</p>
                      </div>
                  </div>
                  <!-- end noresult -->

                  <div class="row mt-3 align-items-center" id="pagination-element">
                      <div class="col-sm">
                          <div class="text-muted text-center text-sm-start">
                              Showing <span class="fw-semibold">{{products?.length}}</span> of <span class="fw-semibold">{{allproducts?.length}}</span> Results
                          </div>
                      </div>

                      <div class="col-sm-auto mt-3 mt-sm-0">
                          <pagination class="pagination-wrap hstack gap-2 justify-content-center" [totalItems]="allproducts.length" [itemsPerPage]="10" (pageChanged)="pageChanged($event)"></pagination>
                      </div>
                  </div>
                  <!-- end pagination-element -->
              </div>
          </div><!--end card-->
      </div><!--end col-->
  </div><!--end row-->
</div>

<!-- deleteRecordModal -->
<div id="deleteRecordModal" class="modal fade zoomIn" bsModal #deleteRecordModal="bs-modal">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="btn-close" id="deleteRecord-close" (click)="deleteRecordModal.hide()"></button>
          </div>
          <div class="modal-body p-md-5">
              <div class="text-center">
                  <div class="text-danger">
                      <i class="bi bi-trash display-4"></i>
                  </div>
                  <div class="mt-4">
                      <h3 class="mb-2">Are you sure ?</h3>
                      <p class="text-muted fs-lg mx-3 mb-0">Are you sure you want to remove this record ?</p>
                  </div>
              </div>
              <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
                  <button type="button" class="btn w-sm btn-light btn-hover" (click)="deleteRecordModal.hide()">Close</button>
                  <button type="button" class="btn w-sm btn-danger btn-hover" id="delete-record" (click)="deleteData(deleteId)">Yes, Delete It!</button>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- Add Product Modal -->
<div class="modal fade" bsModal #showModal="bs-modal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header px-4 pt-4">
                <h5 class="modal-title" id="exampleModalLabel">Add Product</h5>
                <button type="button" class="btn-close" (click)="showModal.hide()"></button>
            </div>

            <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="tablelist-form">
                <div class="modal-body p-4">
                    <!-- Product Name -->
                    <div class="mb-3">
                        <label class="form-label">Product Name</label>
                        <input type="text"
                               class="form-control"
                               formControlName="nomProduit"
                               [ngClass]="{'is-invalid': productForm.get('nomProduit')?.touched && productForm.get('nomProduit')?.invalid}">
                        <div class="invalid-feedback" *ngIf="productForm.get('nomProduit')?.touched && productForm.get('nomProduit')?.invalid">
                            Product name is required
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control"
                                  formControlName="descriptionProduit"
                                  [ngClass]="{'is-invalid': productForm.get('descriptionProduit')?.touched && productForm.get('descriptionProduit')?.invalid}">
                        </textarea>
                        <div class="invalid-feedback" *ngIf="productForm.get('descriptionProduit')?.touched && productForm.get('descriptionProduit')?.invalid">
                            <span *ngIf="productForm.get('descriptionProduit')?.errors?.['required']">Description is required</span>
                            <span *ngIf="productForm.get('descriptionProduit')?.errors?.['minlength']">Description must be at least 10 characters</span>
                        </div>
                    </div>




                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Price</label>
                                <input type="number" class="form-control" formControlName="prixProduit"
                                       [ngClass]="{'is-invalid': productForm.get('prixProduit')?.touched && productForm.get('prixProduit')?.invalid}">
                                <div class="invalid-feedback" *ngIf="productForm.get('prixProduit')?.touched && productForm.get('prixProduit')?.invalid">
                                    <span *ngIf="productForm.get('prixProduit')?.errors?.['required']">Price is required</span>
                                    <span *ngIf="productForm.get('prixProduit')?.errors?.['min']">Price must be greater than 0</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Stock</label>
                                <input type="number" class="form-control" formControlName="stockProduit"
                                       [ngClass]="{'is-invalid': productForm.get('stockProduit')?.touched && productForm.get('stockProduit')?.invalid}">
                                <div class="invalid-feedback" *ngIf="productForm.get('stockProduit')?.touched && productForm.get('stockProduit')?.invalid">
                                    <span *ngIf="productForm.get('stockProduit')?.errors?.['required']">Stock is required</span>
                                    <span *ngIf="productForm.get('stockProduit')?.errors?.['min']">Stock must be at least 1</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select class="form-control" formControlName="categorie">
                            <option [ngValue]="null">Select Category</option>
                            <option *ngFor="let cat of categories" [ngValue]="cat">{{cat.nomCategorie}}</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Product Image</label>
                        <div class="d-flex align-items-center gap-2">
                            <img *ngIf="currentImage"
                                 [src]="currentImage"
                                 class="rounded"
                                 style="height: 100px; width: 100px; object-fit: cover;">
                            <input type="file"
                                   class="form-control"
                                   (change)="onFileSelected($event)"
                                   accept="image/*">
                        </div>
                        <small class="text-muted mt-2">
                            Current image will be kept if no new image is selected
                        </small>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" (click)="showModal.hide()">Close</button>
                    <button type="submit" class="btn btn-primary">
                        Update
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
